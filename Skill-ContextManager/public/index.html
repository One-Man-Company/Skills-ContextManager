<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Context Manager</title>
        <meta
            name="description"
            content="Context Manager ‚Äì manage skills, workflows as a contexts via MCP server. You
            can turn on/off skills and Workflows, change mode Always
            load/Dynamic"
        />
        <link rel="stylesheet" href="styles.css" />
    </head>

    <body>
        <div id="app">
            <!-- ‚ïê‚ïê‚ïê Top Bar ‚ïê‚ïê‚ïê -->
            <div class="top-bar">
                <h1>üß© <span> Skill-ContextManager </span></h1>
                <!--<p>
                    manage skills, workflows as a contexts via MCP server. You
                    can turn on/off skills and Workflows, change mode "Always
                    load" / "Dynamic"
                </p>-->
                <div class="top-bar-actions">
                    <div class="skillhub-selector">
                        <select
                            class="search-input"
                            id="skillhub-dropdown"
                            onchange="switchSkillHub(this.value)"
                            title="Select or create SkillHub"
                        >
                            <option value="">-- Select SkillHub --</option>
                        </select>
                        <button
                            class="btn btn-sm"
                            onclick="showNewSkillHubDialog()"
                            title="Create new SkillHub"
                        >
                            + New
                        </button>
                        <button
                            class="btn btn-sm btn-danger"
                            onclick="deleteCurrentSkillHub()"
                            id="delete-skillhub-btn"
                            style="display: none"
                            title="Delete current SkillHub"
                        >
                            üóë
                        </button>
                    </div>
                    <button
                        class="btn btn-sm"
                        onclick="refreshAll()"
                        title="Refresh"
                    >
                        üîÑ Refresh
                    </button>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê Main 3-Panel Layout ‚ïê‚ïê‚ïê -->
            <script>
                // Apply saved panel widths immediately before render to prevent flash
                (function() {
                    const saved = localStorage.getItem('panel-widths');
                    if (saved) {
                        try {
                            const widths = JSON.parse(saved);
                            const containerWidth = window.innerWidth;
                            const separatorWidth = 4;
                            const skillsWidth = containerWidth - widths.library - widths.context - (separatorWidth * 2);
                            if (skillsWidth > 200) {
                                document.documentElement.style.setProperty('--panel-library', widths.library + 'px');
                                document.documentElement.style.setProperty('--panel-context', widths.context + 'px');
                            }
                        } catch (e) {}
                    }
                })();
            </script>
            <div class="main-content">
                <!-- ‚îÄ‚îÄ Left Panel: Library ‚îÄ‚îÄ -->
                <div class="panel library-panel" id="library-panel">
                    <div class="panel-header">
                        <h2>Library</h2>
                        <div class="library-actions">
                            <button
                                class="btn btn-primary btn-sm"
                                id="library-new-btn"
                                onclick="showNewSkillDialog()"
                            >
                                + New Skill
                            </button>
                            <button
                                class="btn btn-sm"
                                id="library-folder-btn"
                                onclick="triggerFolderImport()"
                                title="Import from Folder"
                            >
                                üìÇ Folder
                            </button>
                            <button
                                class="btn btn-sm"
                                id="library-github-btn"
                                onclick="showGithubImportDialog()"
                                title="Import from GitHub"
                            >
                                üêô GitHub
                            </button>
                            <button
                                class="btn btn-sm"
                                id="library-skillssh-btn"
                                onclick="showSkillsShImportDialog()"
                                title="Import from Skills.sh"
                            >
                                ‚ö° Skills.sh
                            </button>
                        </div>
                        <div class="library-tabs">
                            <div
                                class="library-tab active"
                                data-tab="skills"
                                onclick="switchLibraryTab('skills')"
                            >
                                Skills
                            </div>
                            <div
                                class="library-tab"
                                data-tab="workflows"
                                onclick="switchLibraryTab('workflows')"
                            >
                                Workflows
                            </div>
                        </div>
                        <div class="library-filters">
                            <select id="library-sort" class="filter-select" onchange="filterLibrary()">
                                <option value="name-asc">Name ‚Üë</option>
                                <option value="name-desc">Name ‚Üì</option>
                                <option value="date-desc" selected>Newest</option>
                                <option value="date-asc">Oldest</option>
                            </select>
                            <select id="library-time" class="filter-select" onchange="filterLibrary()">
                                <option value="all">All time</option>
                                <option value="today">Today</option>
                                <option value="week">This week</option>
                                <option value="month">This month</option>
                            </select>
                            <button class="btn btn-sm btn-icon" id="library-fav-btn" onclick="toggleFavFilter()" title="Show favorites only">‚òÜ</button>
                            <button class="btn btn-sm btn-icon" id="library-active-btn" onclick="toggleActiveFilter()" title="Show active/inactive">‚óè</button>
                        </div>
                    </div>
                    <div style="padding: 8px 14px 0" class="search-row">
                        <input
                            type="text"
                            class="search-input"
                            id="library-search"
                            placeholder="Search skills..."
                            oninput="filterLibrary()"
                        />
                        <button class="btn btn-sm search-mode-btn" id="library-search-mode" onclick="toggleLibrarySearchMode()" title="Search in descriptions">üìù</button>
                    </div>
                    <div class="panel-body" id="library-list"></div>
                    <div class="panel-footer" id="library-status">0 skills</div>
                </div>

                <!-- ‚îÄ‚îÄ Separator 1: Between Library and Contexts ‚îÄ‚îÄ -->
                <div class="panel-separator" id="separator1"></div>

                <!-- ‚îÄ‚îÄ Middle Panel: Contexts ‚îÄ‚îÄ -->
                <div class="panel context-panel" id="context-panel">
                    <div class="panel-header">
                        <h2>Context cells</h2>
                        <div class="context-actions">
                            <button
                                class="btn btn-primary btn-sm"
                                onclick="showNewContextDialog()"
                            >
                                + New Context cell
                            </button>
                            <button
                                class="btn btn-sm"
                                onclick="showNewSettingsProfileDialog()"
                                title="Create new settings profile from current settings"
                            >
                                + New Settingsprofile
                            </button>
                            <button
                                class="btn btn-sm"
                                onclick="saveCurrentSettingsProfile()"
                                id="save-profile-btn"
                                disabled
                                title="Save changes to selected profile"
                            >
                                üíæ Save Settingsprofile
                            </button>
                        </div>
                        <div class="settings-profile-selector">
                            <select
                                class="search-input"
                                id="settings-profile-dropdown"
                                onchange="loadSettingsProfile(this.value)"
                            >
                                <option value="">
                                    -- Select Settingsprofile --
                                </option>
                            </select>
                            <button
                                class="btn btn-sm btn-danger"
                                onclick="deleteSettingsProfile()"
                                id="delete-profile-btn"
                                style="display: none"
                                title="Delete selected profile"
                            >
                                üóë
                            </button>
                        </div>
                        <div style="padding-top: 8px;">
                            <input
                                type="text"
                                class="search-input"
                                id="context-search"
                                placeholder="Search contexts..."
                                oninput="filterContexts()"
                            />
                        </div>
                    </div>
                    <div class="panel-body" id="context-list"></div>
                    <div class="panel-footer" id="context-status">
                        0 contexts
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ Separator 2: Between Contexts and Skills ‚îÄ‚îÄ -->
                <div class="panel-separator" id="separator2"></div>

                <!-- ‚îÄ‚îÄ Right Panel: Context Skills ‚îÄ‚îÄ -->
                <div class="panel skills-panel" id="skills-panel">
                    <div class="panel-header">
                        <div class="panel-context-name" id="skills-panel-title">
                            Select a context
                        </div>
                    </div>
                    <div class="panel-body" id="skills-list">
                        <div class="skill-empty-state">
                            <div class="empty-icon">üì¶</div>
                            <p>Context cell not selected</p>
                            <p class="hint">
                                Click a Context cell in the middle panel to view
                                its skills
                            </p>
                        </div>
                    </div>
                    <div class="panel-footer" id="skills-status"></div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê Status Bar ‚ïê‚ïê‚ïê -->
            <div class="status-bar">
                <div class="status-left">
                    <span class="status-indicator"
                        ><span class="status-dot"></span> Connected</span
                    >
                    <span id="status-message">Ready</span>
                </div>
                <span id="status-storage"></span>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Modal Overlay (Skill Editor) ‚ïê‚ïê‚ïê -->
        <div class="modal-overlay" id="skill-editor-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3>
                        üìù <span id="editor-skill-title">Skill Editor</span>
                    </h3>
                    <button class="modal-close" onclick="closeSkillEditor()">
                        ‚úï
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-sidebar">
                        <div class="modal-sidebar-header">
                            <div class="btn-group">
                                <button
                                    class="btn btn-sm btn-primary"
                                    onclick="editorNewFile()"
                                >
                                    + File
                                </button>
                                <button
                                    class="btn btn-sm"
                                    onclick="editorNewFolder()"
                                >
                                    üìÅ Folder
                                </button>
                            </div>
                        </div>
                        <div
                            class="modal-file-list"
                            id="editor-file-list"
                        ></div>
                    </div>
                    <div class="modal-editor">
                        <div
                            class="modal-editor-header"
                            id="editor-header"
                            style="display: none"
                        >
                            <span
                                class="modal-editor-filename"
                                id="editor-filename"
                            ></span>
                            <button
                                class="btn btn-sm btn-primary"
                                onclick="editorSaveFile()"
                            >
                                üíæ Save
                            </button>
                            <button
                                class="btn btn-sm btn-danger"
                                onclick="editorDeleteFile()"
                            >
                                üóë
                            </button>
                        </div>
                        <div class="modal-editor-content">
                            <div class="modal-editor-empty" id="editor-empty">
                                Select a file to edit
                            </div>
                            <textarea
                                id="editor-textarea"
                                style="display: none"
                                placeholder="File content..."
                            ></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Dialog Overlay (Create New) ‚ïê‚ïê‚ïê -->
        <div class="modal-overlay" id="dialog-overlay">
            <div class="dialog" id="dialog-content"></div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Toast Container ‚ïê‚ïê‚ïê -->
        <div class="toast-container" id="toast-container"></div>

        <script src="app.js"></script>
    </body>
</html>
